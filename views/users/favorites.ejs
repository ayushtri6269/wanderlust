<%- layout("/layouts/boilerplate") %>

<div class="container py-5">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="mb-2"><i class="fa-solid fa-heart me-2 text-danger"></i>My Favorites</h1>
      <p class="text-muted">Your saved listings</p>
    </div>
  </div>

  <% if (favorites.length === 0) { %>
    <div class="row">
      <div class="col-12 text-center py-5">
        <i class="fa-solid fa-heart-crack fa-4x text-muted mb-3"></i>
        <h3 class="text-muted">No favorites yet</h3>
        <p class="text-muted">Start exploring and save your favorite listings!</p>
        <a href="/listings" class="btn btn-primary mt-3">
          <i class="fa-solid fa-compass me-2"></i>Explore Listings
        </a>
      </div>
    </div>
  <% } else { %>
    <div class="row row-cols-lg-4 row-cols-md-3 row-cols-sm-1 g-4">
      <% for(let listing of favorites) { %>
        <a class="listing-link" href="/listings/<%= listing._id %>">
          <div class="card col listing-card position-relative">
            <%
              const originalUrl = listing.image && listing.image.url ? listing.image.url : '/images/default.jpg';
              let smallUrl = originalUrl;
              let largeUrl = originalUrl;
              if (originalUrl.includes('/upload')) {
                smallUrl = originalUrl.replace('/upload', '/upload/w_600,h_400,c_fill');
                largeUrl = originalUrl.replace('/upload', '/upload/w_1200,h_800,c_fill');
              }
            %>
            <img src="<%= smallUrl %>" srcset="<%= smallUrl %> 600w, <%= largeUrl %> 1200w" sizes="(min-width:1200px) 25vw, (min-width:768px) 33vw, 100vw" class="card-img-top" alt="<%= listing.title %> image" loading="lazy" />
            <div class="card-img-overlay"></div>
            <span class="price-badge">&#8377; <%= listing.price.toLocaleString("en-IN") %></span>
            <% if (listing.category) { %>
              <span class="category-badge"><%= listing.category %></span>
            <% } %>
            <div class="card-body">
              <p class="card-text">
                <b><%= listing.title %></b><br/>
                <span class="text-muted small"><%= listing.location %>, <%= listing.country %></span>
              </p>
            </div>
          </div>
        </a>
      <% } %>
    </div>

    <div class="row mt-4">
      <div class="col-12 text-center">
        <p class="text-muted">
          <i class="fa-solid fa-heart text-danger me-2"></i>
          You have <%= favorites.length %> saved listing<%= favorites.length === 1 ? '' : 's' %>
        </p>
      </div>
    </div>
  <% } %>
</div>

<style>
.category-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: rgba(255, 255, 255, 0.9);
  color: #333;
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 0.75rem;
  font-weight: 500;
  z-index: 2;
}
</style>
